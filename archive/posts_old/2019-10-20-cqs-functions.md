---
layout: post
title: Команды и запросы
permalink: cqs-functions
tags: functions php
comments: true
subtitle: Разделяем функций на команды и запросы
summary:  Описание принципа command query separation который разделяет все функции на команды и запросы.
is_navigate: true
cover_url: "/assets/images/articles/cq.png"
published: false
---

Существует принцип [Command-query separation](https://ru.wikipedia.org/wiki/CQRS) который гласит, что функция представляет из
себя либо команду, выполняющую какое-либо действие либо запрос который возвращает данные, но не одновременно.
 
## Запрос

Согласно принципу CQRS запросом является функция, которая возвращает результат, 
который в свою очередь основывается на переданных входных параметрах.
Функция не должна менять состояние системы, то есть должна быть [чистой](https://lexusalex.ru/pure-functions)

Если упросить - это просто ответ на заданный вопрос. Например:

~~~php
$array = [];
$server = [];
is_array($array) // типичный предикат, можно вызывать сотни раз и ничего не сломается

is_max_didth($array) // функция вернет максимальное число в массиве

is_prod($server) // функция проверяет является ли данный сервер продом
~~~

## Команда

Это функция, которая выполняет какое-либо действие. 
Может менять состояние системы.
Например функция, которая добавляет пользователя в БД:

~~~php
function create($user) {
    // INSERT INTO ....
    $result = [];
    return $result ? true : false;
}
~~~

Если выполнить этот код повторно с теми же исходными данными, это приведет к ошибке.
В отличие от запроса, команда должна возвращать успешность своего выполнения, но никак не осмысленные данные. 
Команда выполняет недетерминированный код с побочными эффектами.

## Выводы

1. Без выполнения кода из названия функции понятно, что она делает.
2. Кроме того, больше не требуется выполнять код, чтобы понять, что в нем происходит. Отсюда — меньше возможностей для появления ошибок.
3. Простые функции удобнее тестировать, так как не нужно создавать десятки объектов, чтобы запустить тест.
4. Позволяют поддерживать и хранить отдельно команды и запросы. Например можно вынести запросы в отдельный файл или класс

## Ссылки по теме

- [(CQRS) на практике](https://blog.byndyu.ru/2014/07/command-and-query-responsibility.html)
- [На переднем крае - CQRS для обычного приложения](https://msdn.microsoft.com/ru-ru/magazine/mt147237.aspx)
- [Разделение функций на команды и запросы](https://bespoyasov.ru/blog/commands-and-queries/)