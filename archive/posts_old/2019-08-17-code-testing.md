---
layout: post
title: Тестирование кода
permalink: code-testing
tags: tests programming
comments: true
subtitle: Что же такое тестирование кода и зачем это нужно, в чем преимущества и недостатки.
summary: Тестирование кода. Что это такое. Зачем оно нужно. Какими должны быть тесты.
is_navigate: true
cover_url: "/assets/images/articles/testing.png"
published: false
---

## Вводная

Современные программы содержат множество зависимостей и ошибок. 

К примеру ошибки типизации (`1 + []`), недопустимые операции, логические ошибки и другие.

Обнаружить такие ошибки можно руками (`var_dump(), echo, print_r()`) или используя автоматическое тестирование.

Допустим, начинаем проект "Калькулятор". 
Написали, выкатили в прод, пусть это будет большой калькулятор, состоящий из нескольких тысяч строк кода.

К нам начинают сыпаться баги, сразу же их исправляем и назад в прод, поправили, работает, снова правим и т.д.
Это сейчас, хорошо мы помним, что и где было исправлено, а через год, вы легко сможете воспроизвести баг? 
Скорее всего нет.

Нужна некая сетка безопасности, страховка, что все работает. 
Такой сеткой безопасности являются автоматические тесты или как их еще называют unit тесты.

## Ручное тестирование

Все мы в разной степени начинаем с ручного тестирования - это не плохо, но возникают ряд проблем при ручном тестировании:

1. Отсутствие повторяемости. 
Одни и те же действия по выявлению ошибок нужно делать многократно (писать `print_r()` снова и снова), 
при этом нельзя точно сказать, что было протестировано, а что нет;
1. Ручные тесты "долгие" - это значит можно часами сидеть и не видеть ошибку;
1. Невнимательность, человеческий фактор, не все было проверенно. Что-то было упущено из вида;
1. Бесконечные правки;
1. Изменения в коде стоят дорого. В одном месте поправили, сломалось в другом;
1. Если над проектом работают несколько человек. Код проекта меняется с колоссальной скоростью. 
Приходится постоянно проверять, что результат соответствует ожидаемому. При ручных проверках _проверить весь функционал просто невозможно_.

## Автоматическое тестирование

Что же дают нам тесты, и как это облегчает жизнь:

1. Отладку кода можно сразу вести из тестов, без надобности писать перенаправления, заглушки, `exit();`, `var_dump()` и пр.;
1. По тесту можно сразу понять как работает метод, функция, без лишних конструкций. ("Живая документация по коду");
1. Помогают не допускать регрессии готового кода, то есть "новый" код не ломает существующий;
1. Приучают писать маленькие методы и чистые функции, а не пихать всю логику в один метод, который сложно тестировать
и поддерживать;
1. Помогают в ходе написания теста понять, как писать менее связанный код;
1. Автоматическая проверка избавляет разработчика от монотонной ручной проверки всего кода приложения;
1. Уверенность за свой код;
1. Разработка без страха, мы уверены что конкретная функция работает; 
1. _При правильном написании тестов скорость разработки быстрее чем без них_.


## Каким должен быть автоматический тест

Нужно стремиться, чтобы тест был:

1. Повторяемым;
1. Простым для понимания. Не должно быть лишних вычислений;
1. Легко запускаемым;
1. При написании теста лучше на начальном этапе ставить меньше проверок, 
только так можно понять какие проверки нужно добавить в будущем;
1. Тест должен всегда для одних и тех же наборов данных, возвращать один и тот же результат;
1. Работать независимо от других тестов, то есть быть изолированным;
1. При падении теста, понять, каким должен быть результат и где произошла ошибка;
1. Не зависеть от внешнего окружения;
1. Один тест - одна функция, но бывают исключения;
1. Запускаться регулярно;
1. Единый стиль написания теста, код должен быть простым для поддержки.

Преимуществом написания тестов является еще то, что они помогают понимать как будет использоваться моя библиотека.

На написание тестов нужно тратить время, иногда значительное, так же необходимо поддерживать их в актуальном состоянии. 

## Почему не пишут тесты
    
1. Нет времени на них, бизнес не будет ждать, пока ты будешь писать тесты;
1. Нет денег на написание, дорого (это доп расходы, затраты, время);
1. Команда никогда не писала тестов;
1. Нет смысла писать тесты, если никому это не нужно.

И еще вам не нужно писать тесты, если вы всегда пишете код без ошибок, обладаете идеальной памятью и даром предвидения. 
Ваш код настолько хорош, что изменяет себя сам, вслед за требованиями клиента. 
Иногда сам код объясняет клиенту, что его требования - не нужно реализовывать.

Для большинства людей написать тест очень сложно.
Тесты не гарантируют полной работоспособности, но здорово улучшают качество кода.