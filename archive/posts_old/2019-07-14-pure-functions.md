---
layout: post
title: Чистые функции
permalink: pure-functions
tags: php functions
comments: true
summary:  Что такое чистые функции и побочные эффекты.
is_navigate: false
cover_url: "/assets/images/articles/glass.png"
published: false
---

Функции в современных языках программирования играют огромную роль. 
Умение их проектировать и строить - полезный навык для разработчика.

Существует такое понятие как [чистота функции](https://ru.wikipedia.org/wiki/%D0%A7%D0%B8%D1%81%D1%82%D0%BE%D1%82%D0%B0_%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B8)

Чистая функция отвечает двум требованиям:

- результат работы функции должен напрямую зависеть от ее входных параметров (аргументов), такие функции называют _детерминированными_
- функция не должна производить "побочных эффектов"

## Недетерминированные функции

~~~php
<?php
// при каждом новом запуске функция возвращает случайное число
random_int(1, 100); // 5
random_int(1, 100); // 82
~~~

~~~php
<?php
// пример расширяющий предыдущий
// при каждом новом вызове функция с одинаковым входным параметром функция возвращает разный результат
function nondeterministic($int) {
 
   return random_int(1,1000) + date('d') + $int;
}

echo nondeterministic(34); // 2254
echo nondeterministic(34); // 272
~~~

## Детерминированные функции

~~~php
<?php
strlen('string'); // 6 . функция является чистой, так всегда ведет себя предсказуемо возвращает длину строки
~~~
~~~php
<?php
array_key_last([2,3,7]); // 2 . функция вернет последний ключ массива
~~~

## Побочные эффекты

Побочный эффект - это изменение в системе, которое меняет или зависит от среды выполнения.

К ним можно отнести:

- работа с глобальными переменными
- HTTP вызовы (AJAX запросы)
- запись и изменение в файловой системе
- запросы DOM
- запись в stdout, stderr
- изменение аргументов переданных на вход функции
- работа с базой данных
- изменение хода выполнения программы
- вывод на экран
- работа с сетью

Примеры функций с побочными эффектами:

~~~php
<?php
// обращение к глобальной переменной
function side_effect1() {
    
    return $_SERVER['PATH']; // /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
}
// запись в файл
function side_effect2() {
    
    file_put_contents('file.txt', 'Текст для записи', FILE_APPEND); // создание и запись в файл file.txt
}
// печать на экран
function side_effect3() {
    
    echo 'text'; // text
}
~~~

Насколько это возможно, необходимо отделять чистый код от побочных эффектов.

Например нужно вывести результат вычислений на экран из базы данных.
Разбиваем наш код на функции:
1. `connect()` - подключение к базе данных
2. `request()` - запрос к базе данных
3. `calculate()` - обработка результата
4. `print()` - вывод результата на экран или запись в файл

Мы вынесли чистый код обработки результата в функцию `calculate()`. 
Функцию `calculate()` удобно тестировать, так как мы четко знаем что она делает и чем управляет

Чистые функции - это функции к которым нужно стремиться у себя в проектах.